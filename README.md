## bovaa.users.api
Retrieve list of users, and create new users

## Getting Started
The below steps will get this api running in a Docker container.

### Prerequisites
```
Docker
MYSql Database (see repo bovaa.users.db and run the scripts there to create the db)
AWS SQS (Optional)
```

### Get the project running
Find the Dockerfile in the location /Dockerfile.
Replace <dummy> in the Dockerfile with the appropriate values for the 8 environment variables.
Example:
>ENV DB_USERNAME=root
>ENV DB_PASSWORD=admin123

Out of the 8 environment variables specified in the Dockerfile, only the below 4 need to be populated in order to get the api running in minimal mode (no account key will be generated for POST user in this minimal mode):
```
DB_HOST
DB_USERNAME
DB_PASSWORD
DB_NAME
```
Skip to "Build the image" section if you want to get the api running without relying on the third party Account Service.

The other 4 environment, listed below, are only required in order to generate the account key (optional) for the user from a third party service (unreliable) when the user is created.
```
AWS_REGION
AWS_SECRET_ACCESS_KEY
AWS_ACCESS_KEY_ID
ACCOUNT_KEY_REQUESTED_TOPIC
```
Retrieving the account key is achieved by publishing a message SQS (topic is specified by the env variable ACCOUNT_KEY_REQUESTED_TOPIC). There is an event handler that listens polls and processes this queue. For each message in the queue, it will publish an SNS topic, which in turn triggers a second event handler that will get the account key generated by hitting the third party Account Service, and save that key in the db. In case the third party service that generates the account key doesn't respond, the second event handler will publish another message to the same SQS topic with a delay.

### Build the image

Once the environment variables have been set in the Dockerfile, run the below command to build the image:
```
docker build -t uapi .
```
Run the container with the below command:
```
docker run -p 5000:5000 uapi
```

To verify the api is up and running, try the below endpoint, which will give the health and swagger specs of the api respectively
```
/health
/help
```